<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AZUBI.OS â€“ Warenkorb</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="wrap">

    <div class="topbar">
      <div class="brand">
        <span class="dot" aria-hidden="true"></span>
        <span>AZUBI.OS</span>
        <span class="chip"><b>Shop</b> Warenkorb</span>
      </div>

      <nav class="nav">
        <a href="index.html#features">Features</a>
        <a href="index.html#buy">Kaufen</a>
        <a href="cart.html" class="cart-link">
          Warenkorb <span class="cart-badge" id="cartCount">0</span>
        </a>
      </nav>

      <a class="btn btn-primary" href="checkout.html">Checkout</a>
    </div>

    <section class="card section">
      <h2>Warenkorb</h2>
      <p>
        Hier liegt dein Produkt. FÃ¼r die <b>30 Tage Testversion</b> gehtâ€™s Ã¼ber Checkout:
        erst <b>Rechnungsadresse</b>, dann <b>Trial starten</b>.
      </p>

      <div class="split" style="display:grid; grid-template-columns: 1.2fr .8fr; gap: 14px; margin-top:14px;">
        <!-- LEFT: ITEMS -->
        <div class="tile" style="border-radius:18px;">
          <!-- Empty state -->
          <div id="emptyState" style="display:none;">
            <div class="tile" style="border-radius:18px;">
              <div style="font-weight:950; font-size:16px;">Dein Warenkorb ist leer.</div>
              <p style="margin:8px 0 0; color:rgba(255,255,255,.72); line-height:1.55;">
                Pack AZUBI.OS rein und starte danach die <b>30 Tage Gratis-Testversion</b>.
              </p>
              <div class="cta" style="margin-top:12px;">
                <a class="btn btn-primary" href="index.html#buy">Zum Produkt</a>
                <a class="btn" href="index.html">Home</a>
              </div>
            </div>
          </div>

          <!-- Item list -->
          <div id="itemsWrap" style="display:grid; gap:12px;">
            <div class="cart-item" id="cartItem" style="display:none;">
              <div class="cart-thumb">
                <img id="itemImg" src="azubios-box.png" alt="" />
              </div>
              <div>
                <div class="cart-name" id="itemName">AZUBI.OS â€“ Alpha Build</div>
                <div class="cart-meta" id="itemMeta">Einmalig â€¢ Lizenzbox (imaginÃ¤r)</div>

                <div class="cart-row">
                  <div style="display:flex; gap:10px; align-items:center;">
                    <span style="font-weight:950;" id="itemPrice">â‚¬ 29,95</span>
                    <span class="chip" id="itemQtyChip">x1</span>
                  </div>

                  <div style="display:flex; gap:8px; align-items:center;">
                    <button class="tinybtn" id="minusBtn" type="button">âˆ’</button>
                    <button class="tinybtn" id="plusBtn" type="button">+</button>
                    <button class="tinybtn" id="removeAllBtn" type="button">Entfernen</button>
                  </div>
                </div>

                <p class="mini" style="margin-top:10px;">
                  Hinweis: Demo-Shop ohne echtes Payment. Flow ist trotzdem wie ein echter Store.
                </p>
              </div>
            </div>

            <div class="tile" style="border-radius:18px;">
              <div style="font-weight:950;">Warum Checkout?</div>
              <p style="margin:6px 0 0; color:rgba(255,255,255,.72); line-height:1.55;">
                Wir verlangen die Rechnungsadresse <b>vor</b> dem Trial, damit es wie ein echter Shop wirkt:
                Lizenz-Zuordnung, Validierung und sauberer Prozess â€“ <b>nur Demo</b>.
              </p>
            </div>
          </div>
        </div>

        <!-- RIGHT: SUMMARY -->
        <div class="tile" style="border-radius:18px;">
          <div class="sum">
            <div style="display:flex; justify-content:space-between;">
              <span>Zwischensumme</span><b id="subtotal">â‚¬ 0,00</b>
            </div>
            <div style="display:flex; justify-content:space-between;">
              <span>Testversion</span><b>30 Tage gratis</b>
            </div>
            <div class="line2"></div>
            <div style="display:flex; justify-content:space-between; font-size:16px;">
              <span>Heute fÃ¤llig</span><b id="dueToday">â‚¬ 0,00</b>
            </div>
          </div>

          <div class="cta" style="margin-top: 12px;">
            <a class="btn btn-primary" id="checkoutLink" href="checkout.html">Testversion starten</a>
            <a class="btn" href="index.html#buy">Weiter shoppen</a>
          </div>

          <div class="cta" style="margin-top: 10px;">
            <button class="btn" id="clearCartBtn" type="button">Warenkorb leeren</button>
          </div>

          <p class="mini">
            Pro-Tipp: Wenn das Bild nicht aktualisiert â†’ Cache: Dateiname Ã¤ndern (v2) oder Hard Refresh.
          </p>
        </div>
      </div>
    </section>

    <div class="footer">
      Â© 2026 â€“ AZUBI.OS (imaginÃ¤r). Built by Jotham â€¢ Noah â€¢ GÃ©rÃ´me. Pink Mode forever.
    </div>

  </div>

  <script type="module">
    import {
      PRODUCT,
      store,
      fmtEUR,
      toast,
      updateCartBadge,
      cartSubtotal,
      cartCount,
      cartAddOne,
      cartRemoveAll,
      ensureProductInCart
    } from "./shop.js";

    const $ = (id) => document.getElementById(id);

    function render() {
      const cart = store.getCart();
      const count = cartCount(cart);
      updateCartBadge();

      const empty = count <= 0;
      $("emptyState").style.display = empty ? "block" : "none";
      $("cartItem").style.display = empty ? "none" : "grid";
      $("checkoutLink").style.opacity = empty ? ".5" : "1";
      $("checkoutLink").style.pointerEvents = empty ? "none" : "auto";

      const subtotal = cartSubtotal(cart);
      $("subtotal").textContent = fmtEUR(subtotal);
      $("dueToday").textContent = fmtEUR(0);

      if (!empty) {
        const it = cart.find(i => i.id === PRODUCT.id) || cart[0];
        $("itemImg").src = it.img || "azubios-box.png";
        $("itemName").textContent = it.name || "AZUBI.OS";
        $("itemMeta").textContent = "Einmalig â€¢ Lizenzbox (imaginÃ¤r)";
        $("itemPrice").textContent = fmtEUR(it.price || 0);
        $("itemQtyChip").innerHTML = `x${it.qty || 1}`;
      }
    }

    function addOne() {
      cartAddOne();
      toast("âž• Menge erhÃ¶ht.");
      render();
    }

    function minusOne() {
      const cart = store.getCart();
      const idx = cart.findIndex(i => i.id === PRODUCT.id);
      if (idx < 0) return;

      cart[idx].qty = Math.max(0, (cart[idx].qty || 0) - 1);

      // Wenn qty 0 -> entfernen
      if (cart[idx].qty <= 0) cart.splice(idx, 1);

      store.setCart(cart);
      toast("âž– Menge reduziert.");
      render();
    }

    function removeAll() {
      const cart = store.getCart().filter(i => i.id !== PRODUCT.id);
      store.setCart(cart);
      toast("ðŸ—‘ï¸ Artikel entfernt.");
      render();
    }

    function clearCart() {
      cartRemoveAll();
      toast("ðŸ§¹ Warenkorb geleert.");
      render();
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Badge + initial render
      updateCartBadge();
      render();

      // Bind buttons (exist even if hidden)
      $("plusBtn")?.addEventListener("click", addOne);
      $("minusBtn")?.addEventListener("click", minusOne);
      $("removeAllBtn")?.addEventListener("click", removeAll);
      $("clearCartBtn")?.addEventListener("click", clearCart);
    });
  </script>
</body>
</html>
